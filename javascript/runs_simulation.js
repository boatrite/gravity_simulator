// Generated by CoffeeScript 1.7.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.RunsSimulation = (function() {
    function RunsSimulation(universe) {
      this.universe = universe;
      this.pause = __bind(this.pause, this);
      this.play = __bind(this.play, this);
      this.timestamp = __bind(this.timestamp, this);
      this.tick = __bind(this.tick, this);
      this.toggleRunning = __bind(this.toggleRunning, this);
      this.step = 1 / 60;
      this.play();
    }

    RunsSimulation.prototype.toggleRunning = function() {
      if (this.running) {
        return this.pause();
      } else {
        return this.play();
      }
    };

    RunsSimulation.prototype.tick = function() {
      var now;
      this.universe.removeMarkedEntities();
      now = this.timestamp();
      this.dt = this.dt + Math.min(1, (now - this.last) / 1000);
      while (this.dt > this.step) {
        this.dt = this.dt - this.step;
        this.universe.updateAll(this.step);
      }
      this.universe.drawAll();
      this.last = now;
      if (this.running) {
        return requestAnimationFrame(this.tick);
      }
    };

    RunsSimulation.prototype.timestamp = function() {
      if (window.performance && window.performance.now) {
        return window.performance.now();
      } else {
        return new Date().getTime();
      }
    };

    RunsSimulation.prototype.play = function() {
      this.running = true;
      this.dt = 0;
      this.last = this.timestamp();
      return requestAnimationFrame(this.tick);
    };

    RunsSimulation.prototype.pause = function() {
      return this.running = false;
    };

    return RunsSimulation;

  })();

}).call(this);
